[tox]
minversion = 3.1
envlist = pep8,mypy,clean,py{37,38,39,310,311},report

[testenv]
deps =
  -r{toxinidir}/test-requirements.txt
commands =
  pytest -Wall --cov=git_pw --cov-report term-missing {posargs}

[testenv:pep8]
skip_install = true
deps =
  flake8
  black
commands =
  black --check --quiet git_pw tests
  flake8 {posargs:git_pw tests docs}

[testenv:mypy]
deps=
  mypy
  types-PyYAML
  types-requests
  types-setuptools
  types-tabulate
commands=
  mypy {posargs:--ignore-missing-imports --follow-imports=skip} git_pw

[testenv:report]
skip_install = true
deps =
  coverage
commands =
  coverage report
  coverage html

[testenv:clean]
envdir = {toxworkdir}/report
skip_install = true
deps =
  {[testenv:report]deps}
commands =
  coverage erase

[testenv:docs]
deps =
  -r{toxinidir}/docs/requirements.txt
commands =
  sphinx-build {posargs:-E -W} docs docs/_build/html

[testenv:man]
deps =
  click-man~=0.4.0
commands =
  click-man git-pw

[flake8]
show-source = true
